<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>zapata.data API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', ' ', 'auto'); ga('send', 'pageview');
</script><script async src='https://www.google-analytics.com/analytics.js'></script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>zapata.data</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import os
import numpy as np
import xarray as xr
import pandas as pd
import zapata.lib as lib
import netCDF4 as net

# NCEP Reanalysis standard pressure levels
# 1000, 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 100, 70, 50, 30, 20, 10
# 1000  925  850  700  600, 500  400  300, 250, 200, 150, 100      50          10
# 
def read_month(dataset, vardir,var1,level,yy,mm,type,option,verbose=False):
    &#34;&#34;&#34;
    A routine to read one month of data from various datasets.
    
    This routine will read data one month at a time from various data sets
    described in _DataGrid()_
    
    Parameters
    ----------
    dataset :   
        Name of the dataset, ``ERA5``, ``GPCP``  

    vardir :   
        Path to the dataset 

    var1 :   
        Variable to extract 

    level :   
        Level of the Variable   

    yy :    
        Year
    
    mm :    
        Month

    type :   
        Type of data to reay. Currently hardwired to ``npy``

    option :    
        &#39;Celsius&#39;     For temperature Transform to Celsius
    
    verbose: 
        Tons of Output
    
    Returns
    --------
    
    average :
        Monthly data. 
    
    Examples
    --------
    
    &gt;&gt;&gt; read_month(&#39;ERA5&#39;,&#39;.&#39;,&#39;Z&#39;,&#39;500&#39;,1979,12,&#39;npy&#39;,[],verbose=verbose)
    &gt;&gt;&gt; read_month(&#39;GPCP&#39;,&#39;.&#39;,&#39;TPREP&#39;,&#39;SURF&#39;,1979,12,&#39;nc&#39;,[],verbose=verbose) 
    &gt;&gt;&gt; read_month(&#39;ERA5&#39;,&#39;.&#39;,&#39;T&#39;,&#39;850&#39;,1979,12,&#39;npy&#39;,option=Celsius,verbose=verbose)
    &#34;&#34;&#34;
    info=DataGrid()
    if dataset == &#39;ERA5&#39;:
 #       def adddir(name,dir):
 #   return dir +&#39;/&#39; + name.split(&#39;.&#39;)[0]+&#39;.npy&#39;
        fil1=lib.adddir(lib.makemm(var1,str(level),yy,mm),info[dataset][&#39;place&#39;])
        if verbose: print(fil1)
        if var1 == &#39;T&#39; and option == &#39;Celsius&#39;:
            data1=np.load(fil1) - 273.16
        else:
            data1=np.load(fil1)
    elif dataset == &#39;GPCP&#39;:       
        file = info[dataset][&#39;place&#39;] + &#39;/gpcp_cdr_v23rB1_y&#39; + str(yy) + &#39;_m&#39; + &#39;{:02d}&#39;.format(mm) + &#39;.nc&#39;      
        data1 = net.Dataset(file).variables[&#34;precip&#34;][:,:]
    else:
        Print(&#39; Error in read_month, datset set as {}&#39;.format(dataset))
    return data1

def date_param():
    &#34;&#34;&#34; 
    Data Bank to resolve Month and Season averaging information

    Examples
    --------
    &gt;&gt;&gt; index = data_param()
    &gt;&gt;&gt; mon=index[&#39;DJF&#39;][&#39;month_index&#39;]
    &#34;&#34;&#34;
    months=[&#39;JAN&#39;,&#39;FEB&#39;,&#39;MAR&#39;,&#39;APR&#39;,&#39;MAY&#39;,&#39;JUN&#39;,&#39;JUL&#39;,&#39;AUG&#39;,&#39;SEP&#39;,&#39;OCT&#39;,&#39;NOV&#39;,&#39;DEC&#39;]
    DJF ={&#39;label&#39;:&#39;DJF&#39;,&#39;month_index&#39;:[12,1,2]}
    JFM ={&#39;label&#39;:&#39;JFM&#39;,&#39;month_index&#39;:[1,2,3]}
    AMJ ={&#39;label&#39;:&#39;AMJ&#39;,&#39;month_index&#39;:[4,5,6]}
    JJA ={&#39;label&#39;:&#39;JAS&#39;,&#39;month_index&#39;:[6,7,8]}
    JAS ={&#39;label&#39;:&#39;JAS&#39;,&#39;month_index&#39;:[7,8,9]}
    SON ={&#39;label&#39;:&#39;SON&#39;,&#39;month_index&#39;:[10,11,12]}
    ANN ={&#39;label&#39;:&#39;ANN&#39;,&#39;month_index&#39;:[i for i in range(1,13)]}
    JAN ={&#39;label&#39;:&#39;JAN&#39;,&#39;month_index&#39;:[1]}
    FEB ={&#39;label&#39;:&#39;FEB&#39;,&#39;month_index&#39;:[2]}
    MAR ={&#39;label&#39;:&#39;JAN&#39;,&#39;month_index&#39;:[3]}
    APR ={&#39;label&#39;:&#39;APR&#39;,&#39;month_index&#39;:[4]}
    MAY ={&#39;label&#39;:&#39;MAY&#39;,&#39;month_index&#39;:[5]}
    JUN ={&#39;label&#39;:&#39;JUN&#39;,&#39;month_index&#39;:[6]}
    JUL ={&#39;label&#39;:&#39;JUL&#39;,&#39;month_index&#39;:[7]}
    AUG ={&#39;label&#39;:&#39;AUG&#39;,&#39;month_index&#39;:[8]}
    SEP ={&#39;label&#39;:&#39;SEP&#39;,&#39;month_index&#39;:[9]}
    OCT ={&#39;label&#39;:&#39;OCT&#39;,&#39;month_index&#39;:[10]}
    NOV ={&#39;label&#39;:&#39;NOV&#39;,&#39;month_index&#39;:[11]}
    DEC ={&#39;label&#39;:&#39;DEC&#39;,&#39;month_index&#39;:[12]}
    out={&#39;DJF&#39;:DJF,
        &#39;JFM&#39;: JFM,
        &#39;AMJ&#39;: AMJ,
        &#39;JAS&#39;: JAS,
        &#39;JJA&#39;: JJA,
        &#39;SON&#39;: SON,
        &#39;ANN&#39;: ANN,
        &#39;JAN&#39;: JAN,
        &#39;FEB&#39;: FEB,
        &#39;MAR&#39;: MAR,
        &#39;APR&#39;: APR,
        &#39;MAY&#39;: MAY,
        &#39;JUN&#39;: JUN,
        &#39;JUL&#39;: JUL,
        &#39;AUG&#39;: AUG,
        &#39;SEP&#39;: SEP,
        &#39;OCT&#39;: OCT,
        &#39;NOV&#39;: NOV,
        &#39;DEC&#39;: DEC,
        &#39;MONTHS&#39;: months
        }
    return out

def DataGrid(verbose=False):
    &#34;&#34;&#34;
    Routine that returns a Dictionary with information on the reuqested Data Set.

    Currently two data sets are supported   

    * ERA5 -- Subset of monthly data of ERA5 (compiled by AN 2019)   
    * GPCP -- Monthly data of precipitation data set 

    Info can be retrieved as ``grid[dataset][var][&#39;start&#39;]`` for the starting years.
    See source for full explanation of the content.

    Parameters
    ----------

    verbose :   
        True/False      Tons of Output


    Examples
    --------

    &gt;&gt;&gt; info = data_param()
    &gt;&gt;&gt; info = data_param(verbose=True)
    &#34;&#34;&#34;

    homedir = os.path.expanduser(&#34;~&#34;)
    if verbose: print(&#39;Root Directory for Data &#39;,homedir)
    
    U ={      &#39;level&#39;: [10, 50, 100,150, 200,250,300,400,500,600,700,850,925,1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;U&#39;,
              &#39;longname&#39;: &#39;Zonal Wind&#39;,
              &#39;factor&#39;:1
               }
    V ={      &#39;level&#39;: [10,50,100,150,200,250,300,400,500,600, 700,850,925,1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;V&#39;,
              &#39;longname&#39;: &#39;Meridional Wind&#39;,
              &#39;factor&#39;:1
               }
    T ={      &#39;level&#39;: [10,50,100,150, 200,250,300,400, 500,600, 700,850,925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 4,
              &#39;label&#39;: &#39;T&#39;,
              &#39;longname&#39;: &#39;Temperature&#39;,
              &#39;factor&#39;:1
               }
    W ={      &#39;level&#39;: [10,50,100, 150, 200, 250, 300, 400, 500, 600, 700, 850, 925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;W&#39;,
              &#39;longname&#39;: &#39;Vertical Velocity&#39;,
              &#39;factor&#39;:1
               }
    Z ={      &#39;level&#39;: [ 200, 500],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;Z&#39;,
              &#39;longname&#39;: &#39;Geopotential Height&#39;,
              &#39;factor&#39;:1
               }
    tp ={     &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;TP&#39;,
              &#39;longname&#39;: &#39;Precipitation&#39;,
              &#39;factor&#39;:60
               }
    MSL ={     &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 10,
              &#39;label&#39;: &#39;MSL&#39;,
              &#39;longname&#39;: &#39;Mean Sea Level Pressure&#39;,
              &#39;factor&#39;:1/100.
               }
    SST ={    &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 10,
              &#39;label&#39;: &#39;SST&#39;,
              &#39;longname&#39;: &#39;Sea Surface Tenperature&#39;,
              &#39;factor&#39;:1
               }
    THETA ={      &#39;level&#39;: [10,50,100,150, 200,250,300,400, 500,600, 700,850,925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 4,
              &#39;label&#39;: &#39;T&#39;,
              &#39;longname&#39;: &#39;Potential Temperature&#39;,
              &#39;factor&#39;:1
               }
    dataera5={&#39;nlat&#39;: 721,
              &#39;nlon&#39;: 1440,
              &#39;latvec&#39;:[i for i in np.arange(-90,90.1,0.25)],
              &#39;lonvec&#39;: [i for i in np.arange(0,360.1,0.25)],
              &#39;latnp&#39;: np.asarray([i for i in np.arange(-90,90.1,0.25)][::-1]),  # For plotting
              &#39;lonnp&#39;: np.asarray([i for i in np.arange(0,360.1,0.25)]),
              &#39;clim&#39;: homedir + &#39;/Dropbox (CMCC)/ERA5/CLIM&#39;,
              &#39;place&#39;: homedir +&#39;/Dropbox (CMCC)/ERA5/DATA/ERA5_MM&#39;,
              &#39;special_value&#39;: 9999.,
              &#39;U&#39;: U,
              &#39;T&#39;: T,
              &#39;V&#39;: V,
              &#39;W&#39;: W,
              &#39;Z&#39;: Z,
              &#39;tp&#39;: tp,
              &#39;MSL&#39;: MSL,
              &#39;SST&#39;: SST,
              &#39;THETA&#39;: THETA
              }
    
    precip_gpcp ={  &#39;level&#39;: &#39;SURF&#39;,
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;precip&#39;,
              &#39;factor&#39;:1,
              &#39;longname&#39;: &#39;Precipitation GPCP&#39;,
               }
    
    datagpcp={&#39;nlat&#39;: 72,
              &#39;nlon&#39;: 144,
              &#39;latvec&#39;:[i for i in np.arange(-88.75,90.1,2.5)],
              &#39;lonvec&#39;: [i for i in np.arange(1.25,360.1,2.5)],
              &#39;latnp&#39;: np.asarray([i for i in np.arange(-88.75,90.1,2.5)][::-1]),  # For plotting
              &#39;lonnp&#39;: np.asarray([i for i in np.arange(1.25,360.,2.5)]),
              &#39;precip&#39;: precip_gpcp,
              &#39;place&#39;: homedir +&#39;/Dropbox (CMCC)/ERA5/DATA/GPCP/TPREP&#39;,
              &#39;clim&#39;: homedir + &#39;/Dropbox (CMCC)/ERA5/DATA/GPCP/TPREP&#39;
              }


    grid={&#39;ERA5&#39;: dataera5,
          &#39;GPCP&#39;: datagpcp
         }
    return grid


def GPCPInfo():
    &#34;&#34;&#34;Location data for the GPCP data set. &#34;&#34;&#34;
    source_url=&#39;http://gpcp.umd.edu/&#39;
    out = {&#39;Info&#39;: source_url}
    return out   

def ERA5Info():
    &#34;&#34;&#34;Location data for the ERA5 data set. &#34;&#34;&#34;
    source_url=&#39;://confluence.ecmwf.int/display/CKB/ERA5+data+documentation#ERA5datadocumentation-Parameterlistings&#39;
    out = {&#39;Info&#39;: source_url}
    return out

def readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False):
    &#34;&#34;&#34;
    Read Variable from data sets
    
    Parameters
    ----------

    region :    
        &#39;globe&#39; for global maps, or [east, west, north, south]
        for limited region, longitude 0-360
    dataset :   
         name of data set
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    season :    
        Month (&#39;JAN&#39;) or season (,&#39;DJF&#39;) or annual &#39;ANN&#39;)
     
    Celsius :   
        True/False for temperature transform to Celsius
    
    verbose :   
        True/False -- tons of output

    Returns
    -------

    xdat : numpy    
        array data 
    nlon :  
        Number of longitudes
    nlat :  
        Number of Latitudes
    lat :   
        Latitudes
    lon :   
        Longitudes

    Examples
    --------

    &gt;&gt;&gt; readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False)
    &gt;&gt;&gt; readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;SST&#39;,level=&#39;SURF&#39;,season=&#39;JAN&#39;,Celsius=True,verbose=False)
    &#34;&#34;&#34;
    
    vardir = &#39;.&#39;

    dat=date_param()

    grid = DataGrid()
    nlat = grid[dataset][&#39;nlat&#39;]
    nlon = grid[dataset][&#39;nlon&#39;]

    lat = grid[dataset][&#39;latnp&#39;]
    lon = grid[dataset][&#39;lonnp&#39;]
    #Correct for longitude in ERA5
    if dataset ==&#39;ERA5&#39;:
        lon=lon[:-1]

    try:
        grid[dataset][&#39;special_value&#39;]
        if verbose: print(&#39;  Using Special Value ----&gt;&#39;, grid[dataset][&#39;special_value&#39;])
    except:
        print(&#39;  Special Value not defined for dataset {}&#39;.format(dataset))
        
    ys=grid[dataset][var][&#39;start&#39;]
    ye=grid[dataset][var][&#39;end&#39;]
    ys=1979
    ye=2018
    lname=grid[dataset][var][&#39;longname&#39;]

    nyears= ye-ys
    years =[i for i in range(ys,ye+1)]

    factor=grid[dataset][var][&#39;factor&#39;]

    xdat= np.zeros([nlat,nlon,nyears+1])

    for tim in years:
        itim =years.index(tim)
        dat=date_param()
        mon=dat[season][&#39;month_index&#39;]
        if verbose:
            print(&#39; Plotting &#39; + var + &#39; from dataset &#39; + dataset)
            print(&#39;Printing year  &#39;, tim)
        #
        if len(mon) &gt; 1:
            if verbose: print(&#39;Mean on these months: {}&#39;.format(mon))
            temp= np.zeros([nlat,nlon,len(mon)])
            for k in range(len(mon)):
                temp[:,:,k]=read_month(dataset,vardir,var,level,tim,mon[k],&#39;npy&#39;,[],verbose=verbose) 
            xdat[:,:,itim]=np.mean(temp,axis=2)
        else:
            xdat[:,:,itim]=read_month(dataset, vardir,var,level,tim,mon[0],&#39;npy&#39;,[],verbose=verbose) 

    return xdat,nlon, nlat,lat,lon

def read_xarray(dataset=&#39;ERA5&#39;,region=&#39;globe&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;DJF&#39;,verbose=False):
    &#39;&#39;&#39;
    Read npy files from data and generates xarray.

    This a xarray implementation of read_var. It always grabs the global data.

    Parameters
    ----------
    dataset :   
        name of data set   
    region: 
        select region   
        * &#39;globe&#39;, _Entire globe_
        * [East, West, North, South], _Specific region_
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    season :    
        Month (&#39;JAN&#39;) or season (,&#39;DJF&#39;) or annual &#39;ANN&#39;), or &#39;ALL&#39; for every year
    verbose:    
        True/False -- Tons of Output

    Returns
    -------

    out : xarray   
        array data 
    
    &#39;&#39;&#39;
    
    if season != &#39;ALL&#39;:
        xdat,nlon, nlat,lat,lon=readvar_grid(region=&#39;globe&#39;,dataset=dataset, \
                            var=var,level=level,season=season,Celsius=False,verbose=verbose)
        times = pd.date_range(&#39;1979-01-01&#39;, periods=40,freq=&#39;YS&#39;)
    elif season == &#39;ALL&#39;:
        xdat,nlon, nlat,lat,lon=readvar_year(region=&#39;globe&#39;,dataset=dataset, \
                            var=var,level=level,period=&#39;all&#39;,Celsius=False,verbose=verbose)
        times = pd.date_range(&#39;1979-01-01&#39;, periods=480,freq=&#39;MS&#39;)
    
    out = xr.DataArray(xdat, coords=[lat, lon, times], dims=[&#39;lat&#39;,&#39;lon&#39;,&#39;time&#39;])

    if region != &#39;globe&#39;:
        out = out.sel(lon = slice(region[0],region[1]), lat = slice(region[2],region[3]))

    
    return out

def read_dataset(dataset=&#39;ERA5&#39;,region=&#39;globe&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;DJF&#39;,verbose=False):
    &#39;&#39;&#39;
    Similar to `read_xarray` but returns a ``xarray DataSet``
    
    &#39;&#39;&#39;
    
    out = read_xarray(dataset=dataset, region=region, \
                            var=var,level=level,season=season,verbose=verbose)
    ds = xr.Dataset({var: out})
    return ds

def readvar_year(region=&#39;globe&#39;,period=&#39;all&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,
                 Celsius=False,verbose=False):
    &#34;&#34;&#34;
    Read Variable from data banks, all month, no averaging
    
    Parameters
    ----------

    region :    
        &#39;globe&#39; for global maps, or [east, west, north, south]
        for limited region, longitude 0-360
    dataset :   
         name of data set
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    period :    
        Time period to be read  
            * &#39;all&#39; _Every time level in databank_  
            * [start_year,end_year] _period in those years_
     
    Celsius :   
        True/False for temperature transform to Celsius
    
    verbose :   
        True/False -- tons of output

    Returns
    -------

    xdat : numpy    
        array data 
    nlon :  
        Number of longitudes
    nlat :  
        Number of Latitudes
    lat :   
        Latitudes
    lon :   
        Longitudes

    Examples
    --------

    &gt;&gt;&gt; readvar_year(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False)
    &gt;&gt;&gt; readvar_year(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;SST&#39;,level=&#39;SURF&#39;,season=&#39;JAN&#39;,Celsius=True,verbose=False)
    &#34;&#34;&#34;
    
    vardir = &#39;.&#39;

    dat=date_param()

    grid = DataGrid()
    nlat = grid[dataset][&#39;nlat&#39;]
    nlon = grid[dataset][&#39;nlon&#39;]

    lat = grid[dataset][&#39;latnp&#39;]
    lon = grid[dataset][&#39;lonnp&#39;]
    #Correct for longitude in ERA5
    if dataset ==&#39;ERA5&#39;:
        lon=lon[:-1]

    try:
        grid[dataset][&#39;special_value&#39;]
        if verbose: print(&#39;  Using Special Value ----&gt;&#39;, grid[dataset][&#39;special_value&#39;])
    except:
        print(&#39;  Special Value not defined for dataset {}&#39;.format(dataset))

    ys=grid[dataset][var][&#39;start&#39;]
    ye=grid[dataset][var][&#39;end&#39;]
    ys=1979
    ye=2018
    lname=grid[dataset][var][&#39;longname&#39;]
    #Choose period
    if period ==&#39;all&#39;:
        nyears= ye-ys
        years =[i for i in range(ys,ye+1)]
    else:
        nyears= period[1]-period[0]
        years =[i for i in range(period[0],period[1]+1)]

    factor=grid[dataset][var][&#39;factor&#39;]

    xdat= np.zeros([nlat,nlon,12*(nyears+1)])
   
    itim=0
    dat=date_param()
    mon=dat[&#39;ANN&#39;][&#39;month_index&#39;]
    if verbose : print(&#39; Reading &#39; + var + &#39; from databank &#39; + dataset)
    for tim in years:
        print(&#39;Reading year  &#39;, tim)
        for imon in mon:       
            if verbose : print(&#39;Reading mon  &#39;, imon)
            xdat[:,:,itim]=read_month(dataset,vardir,var,level,tim,mon[imon-1],&#39;npy&#39;,[],verbose=verbose)            
            if verbose : print(&#39;Reading time  &#39;, itim)
            itim = itim + 1

    return xdat,nlon, nlat,lat,lon</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="zapata.data.DataGrid"><code class="name flex">
<span>def <span class="ident">DataGrid</span></span>(<span>verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Routine that returns a Dictionary with information on the reuqested Data Set.</p>
<p>Currently two data sets are supported
</p>
<ul>
<li>ERA5 &ndash; Subset of monthly data of ERA5 (compiled by AN 2019)
</li>
<li>GPCP &ndash; Monthly data of precipitation data set </li>
</ul>
<p>Info can be retrieved as <code>grid[dataset][var]['start']</code> for the starting years.
See source for full explanation of the content.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>verbose</code></strong> :&ensp;</dt>
<dd>True/False
Tons of Output</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; info = data_param()
&gt;&gt;&gt; info = data_param(verbose=True)
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def DataGrid(verbose=False):
    &#34;&#34;&#34;
    Routine that returns a Dictionary with information on the reuqested Data Set.

    Currently two data sets are supported   

    * ERA5 -- Subset of monthly data of ERA5 (compiled by AN 2019)   
    * GPCP -- Monthly data of precipitation data set 

    Info can be retrieved as ``grid[dataset][var][&#39;start&#39;]`` for the starting years.
    See source for full explanation of the content.

    Parameters
    ----------

    verbose :   
        True/False      Tons of Output


    Examples
    --------

    &gt;&gt;&gt; info = data_param()
    &gt;&gt;&gt; info = data_param(verbose=True)
    &#34;&#34;&#34;

    homedir = os.path.expanduser(&#34;~&#34;)
    if verbose: print(&#39;Root Directory for Data &#39;,homedir)
    
    U ={      &#39;level&#39;: [10, 50, 100,150, 200,250,300,400,500,600,700,850,925,1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;U&#39;,
              &#39;longname&#39;: &#39;Zonal Wind&#39;,
              &#39;factor&#39;:1
               }
    V ={      &#39;level&#39;: [10,50,100,150,200,250,300,400,500,600, 700,850,925,1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;V&#39;,
              &#39;longname&#39;: &#39;Meridional Wind&#39;,
              &#39;factor&#39;:1
               }
    T ={      &#39;level&#39;: [10,50,100,150, 200,250,300,400, 500,600, 700,850,925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 4,
              &#39;label&#39;: &#39;T&#39;,
              &#39;longname&#39;: &#39;Temperature&#39;,
              &#39;factor&#39;:1
               }
    W ={      &#39;level&#39;: [10,50,100, 150, 200, 250, 300, 400, 500, 600, 700, 850, 925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;W&#39;,
              &#39;longname&#39;: &#39;Vertical Velocity&#39;,
              &#39;factor&#39;:1
               }
    Z ={      &#39;level&#39;: [ 200, 500],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;Z&#39;,
              &#39;longname&#39;: &#39;Geopotential Height&#39;,
              &#39;factor&#39;:1
               }
    tp ={     &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 0.01,
              &#39;label&#39;: &#39;TP&#39;,
              &#39;longname&#39;: &#39;Precipitation&#39;,
              &#39;factor&#39;:60
               }
    MSL ={     &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 10,
              &#39;label&#39;: &#39;MSL&#39;,
              &#39;longname&#39;: &#39;Mean Sea Level Pressure&#39;,
              &#39;factor&#39;:1/100.
               }
    SST ={    &#39;level&#39;: [&#39;SURF&#39;],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 10,
              &#39;label&#39;: &#39;SST&#39;,
              &#39;longname&#39;: &#39;Sea Surface Tenperature&#39;,
              &#39;factor&#39;:1
               }
    THETA ={      &#39;level&#39;: [10,50,100,150, 200,250,300,400, 500,600, 700,850,925, 1000],
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;cv&#39;: 4,
              &#39;label&#39;: &#39;T&#39;,
              &#39;longname&#39;: &#39;Potential Temperature&#39;,
              &#39;factor&#39;:1
               }
    dataera5={&#39;nlat&#39;: 721,
              &#39;nlon&#39;: 1440,
              &#39;latvec&#39;:[i for i in np.arange(-90,90.1,0.25)],
              &#39;lonvec&#39;: [i for i in np.arange(0,360.1,0.25)],
              &#39;latnp&#39;: np.asarray([i for i in np.arange(-90,90.1,0.25)][::-1]),  # For plotting
              &#39;lonnp&#39;: np.asarray([i for i in np.arange(0,360.1,0.25)]),
              &#39;clim&#39;: homedir + &#39;/Dropbox (CMCC)/ERA5/CLIM&#39;,
              &#39;place&#39;: homedir +&#39;/Dropbox (CMCC)/ERA5/DATA/ERA5_MM&#39;,
              &#39;special_value&#39;: 9999.,
              &#39;U&#39;: U,
              &#39;T&#39;: T,
              &#39;V&#39;: V,
              &#39;W&#39;: W,
              &#39;Z&#39;: Z,
              &#39;tp&#39;: tp,
              &#39;MSL&#39;: MSL,
              &#39;SST&#39;: SST,
              &#39;THETA&#39;: THETA
              }
    
    precip_gpcp ={  &#39;level&#39;: &#39;SURF&#39;,
              &#39;start&#39;: 1979,
              &#39;end&#39;: 2018,
              &#39;label&#39;: &#39;precip&#39;,
              &#39;factor&#39;:1,
              &#39;longname&#39;: &#39;Precipitation GPCP&#39;,
               }
    
    datagpcp={&#39;nlat&#39;: 72,
              &#39;nlon&#39;: 144,
              &#39;latvec&#39;:[i for i in np.arange(-88.75,90.1,2.5)],
              &#39;lonvec&#39;: [i for i in np.arange(1.25,360.1,2.5)],
              &#39;latnp&#39;: np.asarray([i for i in np.arange(-88.75,90.1,2.5)][::-1]),  # For plotting
              &#39;lonnp&#39;: np.asarray([i for i in np.arange(1.25,360.,2.5)]),
              &#39;precip&#39;: precip_gpcp,
              &#39;place&#39;: homedir +&#39;/Dropbox (CMCC)/ERA5/DATA/GPCP/TPREP&#39;,
              &#39;clim&#39;: homedir + &#39;/Dropbox (CMCC)/ERA5/DATA/GPCP/TPREP&#39;
              }


    grid={&#39;ERA5&#39;: dataera5,
          &#39;GPCP&#39;: datagpcp
         }
    return grid</code></pre>
</details>
</dd>
<dt id="zapata.data.ERA5Info"><code class="name flex">
<span>def <span class="ident">ERA5Info</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>Location data for the ERA5 data set.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ERA5Info():
    &#34;&#34;&#34;Location data for the ERA5 data set. &#34;&#34;&#34;
    source_url=&#39;://confluence.ecmwf.int/display/CKB/ERA5+data+documentation#ERA5datadocumentation-Parameterlistings&#39;
    out = {&#39;Info&#39;: source_url}
    return out</code></pre>
</details>
</dd>
<dt id="zapata.data.GPCPInfo"><code class="name flex">
<span>def <span class="ident">GPCPInfo</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>Location data for the GPCP data set.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def GPCPInfo():
    &#34;&#34;&#34;Location data for the GPCP data set. &#34;&#34;&#34;
    source_url=&#39;http://gpcp.umd.edu/&#39;
    out = {&#39;Info&#39;: source_url}
    return out   </code></pre>
</details>
</dd>
<dt id="zapata.data.date_param"><code class="name flex">
<span>def <span class="ident">date_param</span></span>(<span>)</span>
</code></dt>
<dd>
<section class="desc"><p>Data Bank to resolve Month and Season averaging information</p>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; index = data_param()
&gt;&gt;&gt; mon=index['DJF']['month_index']
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def date_param():
    &#34;&#34;&#34; 
    Data Bank to resolve Month and Season averaging information

    Examples
    --------
    &gt;&gt;&gt; index = data_param()
    &gt;&gt;&gt; mon=index[&#39;DJF&#39;][&#39;month_index&#39;]
    &#34;&#34;&#34;
    months=[&#39;JAN&#39;,&#39;FEB&#39;,&#39;MAR&#39;,&#39;APR&#39;,&#39;MAY&#39;,&#39;JUN&#39;,&#39;JUL&#39;,&#39;AUG&#39;,&#39;SEP&#39;,&#39;OCT&#39;,&#39;NOV&#39;,&#39;DEC&#39;]
    DJF ={&#39;label&#39;:&#39;DJF&#39;,&#39;month_index&#39;:[12,1,2]}
    JFM ={&#39;label&#39;:&#39;JFM&#39;,&#39;month_index&#39;:[1,2,3]}
    AMJ ={&#39;label&#39;:&#39;AMJ&#39;,&#39;month_index&#39;:[4,5,6]}
    JJA ={&#39;label&#39;:&#39;JAS&#39;,&#39;month_index&#39;:[6,7,8]}
    JAS ={&#39;label&#39;:&#39;JAS&#39;,&#39;month_index&#39;:[7,8,9]}
    SON ={&#39;label&#39;:&#39;SON&#39;,&#39;month_index&#39;:[10,11,12]}
    ANN ={&#39;label&#39;:&#39;ANN&#39;,&#39;month_index&#39;:[i for i in range(1,13)]}
    JAN ={&#39;label&#39;:&#39;JAN&#39;,&#39;month_index&#39;:[1]}
    FEB ={&#39;label&#39;:&#39;FEB&#39;,&#39;month_index&#39;:[2]}
    MAR ={&#39;label&#39;:&#39;JAN&#39;,&#39;month_index&#39;:[3]}
    APR ={&#39;label&#39;:&#39;APR&#39;,&#39;month_index&#39;:[4]}
    MAY ={&#39;label&#39;:&#39;MAY&#39;,&#39;month_index&#39;:[5]}
    JUN ={&#39;label&#39;:&#39;JUN&#39;,&#39;month_index&#39;:[6]}
    JUL ={&#39;label&#39;:&#39;JUL&#39;,&#39;month_index&#39;:[7]}
    AUG ={&#39;label&#39;:&#39;AUG&#39;,&#39;month_index&#39;:[8]}
    SEP ={&#39;label&#39;:&#39;SEP&#39;,&#39;month_index&#39;:[9]}
    OCT ={&#39;label&#39;:&#39;OCT&#39;,&#39;month_index&#39;:[10]}
    NOV ={&#39;label&#39;:&#39;NOV&#39;,&#39;month_index&#39;:[11]}
    DEC ={&#39;label&#39;:&#39;DEC&#39;,&#39;month_index&#39;:[12]}
    out={&#39;DJF&#39;:DJF,
        &#39;JFM&#39;: JFM,
        &#39;AMJ&#39;: AMJ,
        &#39;JAS&#39;: JAS,
        &#39;JJA&#39;: JJA,
        &#39;SON&#39;: SON,
        &#39;ANN&#39;: ANN,
        &#39;JAN&#39;: JAN,
        &#39;FEB&#39;: FEB,
        &#39;MAR&#39;: MAR,
        &#39;APR&#39;: APR,
        &#39;MAY&#39;: MAY,
        &#39;JUN&#39;: JUN,
        &#39;JUL&#39;: JUL,
        &#39;AUG&#39;: AUG,
        &#39;SEP&#39;: SEP,
        &#39;OCT&#39;: OCT,
        &#39;NOV&#39;: NOV,
        &#39;DEC&#39;: DEC,
        &#39;MONTHS&#39;: months
        }
    return out</code></pre>
</details>
</dd>
<dt id="zapata.data.read_dataset"><code class="name flex">
<span>def <span class="ident">read_dataset</span></span>(<span>dataset='ERA5', region='globe', var='Z', level='500', season='DJF', verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Similar to <a title="zapata.data.read_xarray" href="#zapata.data.read_xarray"><code>read_xarray()</code></a> but returns a <code>xarray DataSet</code></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_dataset(dataset=&#39;ERA5&#39;,region=&#39;globe&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;DJF&#39;,verbose=False):
    &#39;&#39;&#39;
    Similar to `read_xarray` but returns a ``xarray DataSet``
    
    &#39;&#39;&#39;
    
    out = read_xarray(dataset=dataset, region=region, \
                            var=var,level=level,season=season,verbose=verbose)
    ds = xr.Dataset({var: out})
    return ds</code></pre>
</details>
</dd>
<dt id="zapata.data.read_month"><code class="name flex">
<span>def <span class="ident">read_month</span></span>(<span>dataset, vardir, var1, level, yy, mm, type, option, verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>A routine to read one month of data from various datasets.</p>
<p>This routine will read data one month at a time from various data sets
described in <em>DataGrid()</em></p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>dataset</code></strong> :&ensp;</dt>
<dd>Name of the dataset, <code>ERA5</code>, <code>GPCP</code></dd>
<dt><strong><code>vardir</code></strong> :&ensp;</dt>
<dd>Path to the dataset</dd>
<dt><strong><code>var1</code></strong> :&ensp;</dt>
<dd>Variable to extract</dd>
<dt><strong><code>level</code></strong> :&ensp;</dt>
<dd>Level of the Variable</dd>
<dt><strong><code>yy</code></strong> :&ensp;</dt>
<dd>Year</dd>
<dt><strong><code>mm</code></strong> :&ensp;</dt>
<dd>Month</dd>
<dt><strong><code>type</code></strong> :&ensp;</dt>
<dd>Type of data to reay. Currently hardwired to <code>npy</code></dd>
<dt><strong><code>option</code></strong> :&ensp;</dt>
<dd>'Celsius'
For temperature Transform to Celsius</dd>
<dt><strong><code>verbose</code></strong></dt>
<dd>Tons of Output</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>average</code> :</dt>
<dd>Monthly data.</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; read_month('ERA5','.','Z','500',1979,12,'npy',[],verbose=verbose)
&gt;&gt;&gt; read_month('GPCP','.','TPREP','SURF',1979,12,'nc',[],verbose=verbose) 
&gt;&gt;&gt; read_month('ERA5','.','T','850',1979,12,'npy',option=Celsius,verbose=verbose)
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_month(dataset, vardir,var1,level,yy,mm,type,option,verbose=False):
    &#34;&#34;&#34;
    A routine to read one month of data from various datasets.
    
    This routine will read data one month at a time from various data sets
    described in _DataGrid()_
    
    Parameters
    ----------
    dataset :   
        Name of the dataset, ``ERA5``, ``GPCP``  

    vardir :   
        Path to the dataset 

    var1 :   
        Variable to extract 

    level :   
        Level of the Variable   

    yy :    
        Year
    
    mm :    
        Month

    type :   
        Type of data to reay. Currently hardwired to ``npy``

    option :    
        &#39;Celsius&#39;     For temperature Transform to Celsius
    
    verbose: 
        Tons of Output
    
    Returns
    --------
    
    average :
        Monthly data. 
    
    Examples
    --------
    
    &gt;&gt;&gt; read_month(&#39;ERA5&#39;,&#39;.&#39;,&#39;Z&#39;,&#39;500&#39;,1979,12,&#39;npy&#39;,[],verbose=verbose)
    &gt;&gt;&gt; read_month(&#39;GPCP&#39;,&#39;.&#39;,&#39;TPREP&#39;,&#39;SURF&#39;,1979,12,&#39;nc&#39;,[],verbose=verbose) 
    &gt;&gt;&gt; read_month(&#39;ERA5&#39;,&#39;.&#39;,&#39;T&#39;,&#39;850&#39;,1979,12,&#39;npy&#39;,option=Celsius,verbose=verbose)
    &#34;&#34;&#34;
    info=DataGrid()
    if dataset == &#39;ERA5&#39;:
 #       def adddir(name,dir):
 #   return dir +&#39;/&#39; + name.split(&#39;.&#39;)[0]+&#39;.npy&#39;
        fil1=lib.adddir(lib.makemm(var1,str(level),yy,mm),info[dataset][&#39;place&#39;])
        if verbose: print(fil1)
        if var1 == &#39;T&#39; and option == &#39;Celsius&#39;:
            data1=np.load(fil1) - 273.16
        else:
            data1=np.load(fil1)
    elif dataset == &#39;GPCP&#39;:       
        file = info[dataset][&#39;place&#39;] + &#39;/gpcp_cdr_v23rB1_y&#39; + str(yy) + &#39;_m&#39; + &#39;{:02d}&#39;.format(mm) + &#39;.nc&#39;      
        data1 = net.Dataset(file).variables[&#34;precip&#34;][:,:]
    else:
        Print(&#39; Error in read_month, datset set as {}&#39;.format(dataset))
    return data1</code></pre>
</details>
</dd>
<dt id="zapata.data.read_xarray"><code class="name flex">
<span>def <span class="ident">read_xarray</span></span>(<span>dataset='ERA5', region='globe', var='Z', level='500', season='DJF', verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Read npy files from data and generates xarray.</p>
<p>This a xarray implementation of read_var. It always grabs the global data.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>dataset</code></strong> :&ensp;</dt>
<dd>name of data set</dd>
<dt><strong><code>region</code></strong></dt>
<dd>select region <br>
* 'globe', <em>Entire globe</em>
* [East, West, North, South], <em>Specific region</em></dd>
<dt><strong><code>var</code></strong> :&ensp;</dt>
<dd>variable name</dd>
<dt><strong><code>level</code></strong></dt>
<dd>level, either a value or 'SURF' for surface fields</dd>
<dt><strong><code>season</code></strong> :&ensp;</dt>
<dd>Month ('JAN') or season (,'DJF') or annual 'ANN'), or 'ALL' for every year</dd>
<dt><strong><code>verbose</code></strong> :&ensp;</dt>
<dd>True/False &ndash; Tons of Output</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>out</code></strong> :&ensp;<code>xarray</code></dt>
<dd>array data</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_xarray(dataset=&#39;ERA5&#39;,region=&#39;globe&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;DJF&#39;,verbose=False):
    &#39;&#39;&#39;
    Read npy files from data and generates xarray.

    This a xarray implementation of read_var. It always grabs the global data.

    Parameters
    ----------
    dataset :   
        name of data set   
    region: 
        select region   
        * &#39;globe&#39;, _Entire globe_
        * [East, West, North, South], _Specific region_
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    season :    
        Month (&#39;JAN&#39;) or season (,&#39;DJF&#39;) or annual &#39;ANN&#39;), or &#39;ALL&#39; for every year
    verbose:    
        True/False -- Tons of Output

    Returns
    -------

    out : xarray   
        array data 
    
    &#39;&#39;&#39;
    
    if season != &#39;ALL&#39;:
        xdat,nlon, nlat,lat,lon=readvar_grid(region=&#39;globe&#39;,dataset=dataset, \
                            var=var,level=level,season=season,Celsius=False,verbose=verbose)
        times = pd.date_range(&#39;1979-01-01&#39;, periods=40,freq=&#39;YS&#39;)
    elif season == &#39;ALL&#39;:
        xdat,nlon, nlat,lat,lon=readvar_year(region=&#39;globe&#39;,dataset=dataset, \
                            var=var,level=level,period=&#39;all&#39;,Celsius=False,verbose=verbose)
        times = pd.date_range(&#39;1979-01-01&#39;, periods=480,freq=&#39;MS&#39;)
    
    out = xr.DataArray(xdat, coords=[lat, lon, times], dims=[&#39;lat&#39;,&#39;lon&#39;,&#39;time&#39;])

    if region != &#39;globe&#39;:
        out = out.sel(lon = slice(region[0],region[1]), lat = slice(region[2],region[3]))

    
    return out</code></pre>
</details>
</dd>
<dt id="zapata.data.readvar_grid"><code class="name flex">
<span>def <span class="ident">readvar_grid</span></span>(<span>region='globe', dataset='ERA5', var='Z', level='500', season='JAN', Celsius=False, verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Read Variable from data sets</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>region</code></strong> :&ensp;</dt>
<dd>'globe' for global maps, or [east, west, north, south]
for limited region, longitude 0-360</dd>
<dt><strong><code>dataset</code></strong> :&ensp;</dt>
<dd>name of data set</dd>
<dt><strong><code>var</code></strong> :&ensp;</dt>
<dd>variable name</dd>
<dt><strong><code>level</code></strong></dt>
<dd>level, either a value or 'SURF' for surface fields</dd>
<dt><strong><code>season</code></strong> :&ensp;</dt>
<dd>Month ('JAN') or season (,'DJF') or annual 'ANN')</dd>
<dt><strong><code>Celsius</code></strong> :&ensp;</dt>
<dd>True/False for temperature transform to Celsius</dd>
<dt><strong><code>verbose</code></strong> :&ensp;</dt>
<dd>True/False &ndash; tons of output</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>xdat</code></strong> :&ensp;<code>numpy</code></dt>
<dd>array data</dd>
<dt><strong><code>nlon</code></strong> :&ensp;</dt>
<dd>Number of longitudes</dd>
<dt><strong><code>nlat</code></strong> :&ensp;</dt>
<dd>Number of Latitudes</dd>
<dt><strong><code>lat</code></strong> :&ensp;</dt>
<dd>Latitudes</dd>
<dt><strong><code>lon</code></strong> :&ensp;</dt>
<dd>Longitudes</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; readvar_grid(region='globe',dataset='ERA5',var='Z',level='500',season='JAN',Celsius=False,verbose=False)
&gt;&gt;&gt; readvar_grid(region='globe',dataset='ERA5',var='SST',level='SURF',season='JAN',Celsius=True,verbose=False)
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False):
    &#34;&#34;&#34;
    Read Variable from data sets
    
    Parameters
    ----------

    region :    
        &#39;globe&#39; for global maps, or [east, west, north, south]
        for limited region, longitude 0-360
    dataset :   
         name of data set
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    season :    
        Month (&#39;JAN&#39;) or season (,&#39;DJF&#39;) or annual &#39;ANN&#39;)
     
    Celsius :   
        True/False for temperature transform to Celsius
    
    verbose :   
        True/False -- tons of output

    Returns
    -------

    xdat : numpy    
        array data 
    nlon :  
        Number of longitudes
    nlat :  
        Number of Latitudes
    lat :   
        Latitudes
    lon :   
        Longitudes

    Examples
    --------

    &gt;&gt;&gt; readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False)
    &gt;&gt;&gt; readvar_grid(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;SST&#39;,level=&#39;SURF&#39;,season=&#39;JAN&#39;,Celsius=True,verbose=False)
    &#34;&#34;&#34;
    
    vardir = &#39;.&#39;

    dat=date_param()

    grid = DataGrid()
    nlat = grid[dataset][&#39;nlat&#39;]
    nlon = grid[dataset][&#39;nlon&#39;]

    lat = grid[dataset][&#39;latnp&#39;]
    lon = grid[dataset][&#39;lonnp&#39;]
    #Correct for longitude in ERA5
    if dataset ==&#39;ERA5&#39;:
        lon=lon[:-1]

    try:
        grid[dataset][&#39;special_value&#39;]
        if verbose: print(&#39;  Using Special Value ----&gt;&#39;, grid[dataset][&#39;special_value&#39;])
    except:
        print(&#39;  Special Value not defined for dataset {}&#39;.format(dataset))
        
    ys=grid[dataset][var][&#39;start&#39;]
    ye=grid[dataset][var][&#39;end&#39;]
    ys=1979
    ye=2018
    lname=grid[dataset][var][&#39;longname&#39;]

    nyears= ye-ys
    years =[i for i in range(ys,ye+1)]

    factor=grid[dataset][var][&#39;factor&#39;]

    xdat= np.zeros([nlat,nlon,nyears+1])

    for tim in years:
        itim =years.index(tim)
        dat=date_param()
        mon=dat[season][&#39;month_index&#39;]
        if verbose:
            print(&#39; Plotting &#39; + var + &#39; from dataset &#39; + dataset)
            print(&#39;Printing year  &#39;, tim)
        #
        if len(mon) &gt; 1:
            if verbose: print(&#39;Mean on these months: {}&#39;.format(mon))
            temp= np.zeros([nlat,nlon,len(mon)])
            for k in range(len(mon)):
                temp[:,:,k]=read_month(dataset,vardir,var,level,tim,mon[k],&#39;npy&#39;,[],verbose=verbose) 
            xdat[:,:,itim]=np.mean(temp,axis=2)
        else:
            xdat[:,:,itim]=read_month(dataset, vardir,var,level,tim,mon[0],&#39;npy&#39;,[],verbose=verbose) 

    return xdat,nlon, nlat,lat,lon</code></pre>
</details>
</dd>
<dt id="zapata.data.readvar_year"><code class="name flex">
<span>def <span class="ident">readvar_year</span></span>(<span>region='globe', period='all', dataset='ERA5', var='Z', level='500', Celsius=False, verbose=False)</span>
</code></dt>
<dd>
<section class="desc"><p>Read Variable from data banks, all month, no averaging</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>region</code></strong> :&ensp;</dt>
<dd>'globe' for global maps, or [east, west, north, south]
for limited region, longitude 0-360</dd>
<dt><strong><code>dataset</code></strong> :&ensp;</dt>
<dd>name of data set</dd>
<dt><strong><code>var</code></strong> :&ensp;</dt>
<dd>variable name</dd>
<dt><strong><code>level</code></strong></dt>
<dd>level, either a value or 'SURF' for surface fields</dd>
<dt><strong><code>period</code></strong> :&ensp;</dt>
<dd>Time period to be read<br>
* 'all' <em>Every time level in databank</em><br>
* [start_year,end_year] <em>period in those years</em></dd>
<dt><strong><code>Celsius</code></strong> :&ensp;</dt>
<dd>True/False for temperature transform to Celsius</dd>
<dt><strong><code>verbose</code></strong> :&ensp;</dt>
<dd>True/False &ndash; tons of output</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>xdat</code></strong> :&ensp;<code>numpy</code></dt>
<dd>array data</dd>
<dt><strong><code>nlon</code></strong> :&ensp;</dt>
<dd>Number of longitudes</dd>
<dt><strong><code>nlat</code></strong> :&ensp;</dt>
<dd>Number of Latitudes</dd>
<dt><strong><code>lat</code></strong> :&ensp;</dt>
<dd>Latitudes</dd>
<dt><strong><code>lon</code></strong> :&ensp;</dt>
<dd>Longitudes</dd>
</dl>
<h2 id="examples">Examples</h2>
<pre><code>&gt;&gt;&gt; readvar_year(region='globe',dataset='ERA5',var='Z',level='500',season='JAN',Celsius=False,verbose=False)
&gt;&gt;&gt; readvar_year(region='globe',dataset='ERA5',var='SST',level='SURF',season='JAN',Celsius=True,verbose=False)
</code></pre></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def readvar_year(region=&#39;globe&#39;,period=&#39;all&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,
                 Celsius=False,verbose=False):
    &#34;&#34;&#34;
    Read Variable from data banks, all month, no averaging
    
    Parameters
    ----------

    region :    
        &#39;globe&#39; for global maps, or [east, west, north, south]
        for limited region, longitude 0-360
    dataset :   
         name of data set
    var :   
         variable name
    level : 
        level, either a value or &#39;SURF&#39; for surface fields

    period :    
        Time period to be read  
            * &#39;all&#39; _Every time level in databank_  
            * [start_year,end_year] _period in those years_
     
    Celsius :   
        True/False for temperature transform to Celsius
    
    verbose :   
        True/False -- tons of output

    Returns
    -------

    xdat : numpy    
        array data 
    nlon :  
        Number of longitudes
    nlat :  
        Number of Latitudes
    lat :   
        Latitudes
    lon :   
        Longitudes

    Examples
    --------

    &gt;&gt;&gt; readvar_year(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;Z&#39;,level=&#39;500&#39;,season=&#39;JAN&#39;,Celsius=False,verbose=False)
    &gt;&gt;&gt; readvar_year(region=&#39;globe&#39;,dataset=&#39;ERA5&#39;,var=&#39;SST&#39;,level=&#39;SURF&#39;,season=&#39;JAN&#39;,Celsius=True,verbose=False)
    &#34;&#34;&#34;
    
    vardir = &#39;.&#39;

    dat=date_param()

    grid = DataGrid()
    nlat = grid[dataset][&#39;nlat&#39;]
    nlon = grid[dataset][&#39;nlon&#39;]

    lat = grid[dataset][&#39;latnp&#39;]
    lon = grid[dataset][&#39;lonnp&#39;]
    #Correct for longitude in ERA5
    if dataset ==&#39;ERA5&#39;:
        lon=lon[:-1]

    try:
        grid[dataset][&#39;special_value&#39;]
        if verbose: print(&#39;  Using Special Value ----&gt;&#39;, grid[dataset][&#39;special_value&#39;])
    except:
        print(&#39;  Special Value not defined for dataset {}&#39;.format(dataset))

    ys=grid[dataset][var][&#39;start&#39;]
    ye=grid[dataset][var][&#39;end&#39;]
    ys=1979
    ye=2018
    lname=grid[dataset][var][&#39;longname&#39;]
    #Choose period
    if period ==&#39;all&#39;:
        nyears= ye-ys
        years =[i for i in range(ys,ye+1)]
    else:
        nyears= period[1]-period[0]
        years =[i for i in range(period[0],period[1]+1)]

    factor=grid[dataset][var][&#39;factor&#39;]

    xdat= np.zeros([nlat,nlon,12*(nyears+1)])
   
    itim=0
    dat=date_param()
    mon=dat[&#39;ANN&#39;][&#39;month_index&#39;]
    if verbose : print(&#39; Reading &#39; + var + &#39; from databank &#39; + dataset)
    for tim in years:
        print(&#39;Reading year  &#39;, tim)
        for imon in mon:       
            if verbose : print(&#39;Reading mon  &#39;, imon)
            xdat[:,:,itim]=read_month(dataset,vardir,var,level,tim,mon[imon-1],&#39;npy&#39;,[],verbose=verbose)            
            if verbose : print(&#39;Reading time  &#39;, itim)
            itim = itim + 1

    return xdat,nlon, nlat,lat,lon</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<!DOCTYPE html>
<html>
<head>
<title>HTML img Tag</title>
</head>
<body>
<img src="../resources/zap.png" alt="Simply Easy Learning" width="400"
height="260">
</body>
</html>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="zapata" href="index.html">zapata</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="zapata.data.DataGrid" href="#zapata.data.DataGrid">DataGrid</a></code></li>
<li><code><a title="zapata.data.ERA5Info" href="#zapata.data.ERA5Info">ERA5Info</a></code></li>
<li><code><a title="zapata.data.GPCPInfo" href="#zapata.data.GPCPInfo">GPCPInfo</a></code></li>
<li><code><a title="zapata.data.date_param" href="#zapata.data.date_param">date_param</a></code></li>
<li><code><a title="zapata.data.read_dataset" href="#zapata.data.read_dataset">read_dataset</a></code></li>
<li><code><a title="zapata.data.read_month" href="#zapata.data.read_month">read_month</a></code></li>
<li><code><a title="zapata.data.read_xarray" href="#zapata.data.read_xarray">read_xarray</a></code></li>
<li><code><a title="zapata.data.readvar_grid" href="#zapata.data.readvar_grid">readvar_grid</a></code></li>
<li><code><a title="zapata.data.readvar_year" href="#zapata.data.readvar_year">readvar_year</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>